  <mat-divider class="my-4"></mat-divider>

<div class="relative bg-gray-900 h-56 md:h-64 flex items-center justify-center text-white">

  <img
    src="assets/images/shop-hero.jpg"
    alt="Library background"
    class="absolute inset-0 w-full h-full object-cover opacity-30">

  <div class="relative z-10 text-center p-4">
    <h1 class="text-4xl md:text-5xl font-serif font-bold">Our Shop</h1>
    <p class="text-lg text-gray-200 mt-2 hidden md:block">Find your next great read.</p>

  </div>
</div>
  <mat-divider class="my-2"></mat-divider>

<div class="container mx-auto px-4 py-16 mb-20">
  <div class="flex flex-col lg:flex-row gap-10">

    <aside class="w-full lg:w-1/4 lg:sticky lg:top-24 h-fit">

      <div class="mb-6 relative">
        <input
          type="text"
          [formControl]="searchControl"
          placeholder="Search by keyword..."
          class="w-full px-4 py-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-cyan-500 pr-10">
        <mat-icon class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-400">search</mat-icon>
      </div>

      <div class="flex justify-between items-center mb-4">
        <h2 class="text-2xl font-bold text-gray-800">Filters</h2>
        <button (click)="clearFilters()" class="text-sm font-medium text-cyan-600 hover:text-cyan-800">
          Clear All
        </button>
      </div>

      <form [formGroup]="filterForm" class="border-t border-gray-200">

        <div class="border-b border-gray-200 py-5">
          <button (click)="isPriceExpanded.set(!isPriceExpanded())" class="w-full flex justify-between
          items-center font-bold text-lg text-gray-800">
            Price
            <mat-icon class="transition-transform" [class.rotate-180]="!isPriceExpanded()">expand_more</mat-icon>
          </button>
          @if (isPriceExpanded()) {
            <div class="mt-4 flex items-center gap-3">
              <input
                type="number"
                formControlName="minPrice"
                placeholder="From"
                min="0"
                class="w-1/2 border border-gray-300 rounded-md px-3 py-2
                text-center focus:outline-none focus:ring-1 focus:ring-cyan-500">
              <span class="text-gray-400">-</span>
              <input
                type="number"
                formControlName="maxPrice"
                placeholder="To"
                min="0"
                class="w-1/2 border border-gray-300 rounded-md px-3 py-2 text-center
                focus:outline-none focus:ring-1 focus:ring-cyan-500">
            </div>
          }
        </div>

        <div class="border-b border-gray-200 py-5">
          <button (click)="isCategoryExpanded.set(!isCategoryExpanded())" class="w-full flex
          justify-between items-center font-bold text-lg text-gray-800">
            Category
            <mat-icon class="transition-transform" [class.rotate-180]="!isCategoryExpanded()">expand_more</mat-icon>
          </button>
          @if (isCategoryExpanded()) {
            <div class="mt-4 flex flex-col gap-2 max-h-60 overflow-y-auto pr-2">
              @for (category of facets()?.categories; track category._id) {
                <label class="flex items-center gap-3 p-1.5 cursor-pointer hover:bg-gray-50 rounded">
                  <input
                    type="checkbox"
                    [checked]="isCategorySelected(category._id)"
                    (change)="onCategoryChange($event, category._id)"
                    class="w-5 h-5 rounded text-cyan-600 border-gray-300 focus:ring-cyan-500">
                  <span class="flex-1 text-gray-700">{{ category._id | titlecase }}</span>
                  <span class="text-sm text-gray-400">({{ category.count }})</span>
                </label>
              } @empty {
                <p class="text-gray-400 text-sm p-2">No categories found.</p>
              }
            </div>
          }
        </div>

        <div class="border-b border-gray-200 py-5">
          <button (click)="isAuthorExpanded.set(!isAuthorExpanded())" class="w-full flex justify-between
          items-center font-bold text-lg text-gray-800">
            Author
            <mat-icon class="transition-transform" [class.rotate-180]="!isAuthorExpanded()">expand_more</mat-icon>
          </button>
          @if (isAuthorExpanded()) {
            <div class="mt-4 flex flex-col gap-2 max-h-60 overflow-y-auto pr-2">
              @for (author of facets()?.authors; track author._id) {
                <label class="flex items-center gap-3 p-1.5 cursor-pointer hover:bg-gray-50 rounded">
                  <input
                    type="checkbox"
                    [checked]="isAuthorSelected(author._id)"
                    (change)="onAuthorChange($event, author._id)"
                    class="w-5 h-5 rounded text-cyan-600 border-gray-300 focus:ring-cyan-500">
                  <span class="flex-1 text-gray-700">{{ author._id }}</span>
                  <span class="text-sm text-gray-400">({{ author.count }})</span>
                </label>
              } @empty {
                <p class="text-gray-400 text-sm p-2">No authors found.</p>
              }
            </div>
          }
        </div>

      </form>
    </aside>

    <main class="w-full lg:w-3/4">

      <div class="flex flex-col md:flex-row justify-between md:items-center gap-4
       mb-6 p-4 bg-gray-50 rounded-lg border border-gray-200">
        <p class="text-sm text-gray-600">
          Showing <span class="font-bold">{{ books().length }}</span> of
          <span class="font-bold">{{ totalBooks() }}</span> results
        </p>
        <select [formControl]="sortControl" class="w-full md:w-56 border border-gray-300
        rounded-md px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-cyan-500 bg-white">
          <option value="createdAt:desc">Sort by: Newest</option>
          <option value="price:asc">Sort by: Price: Low to High</option>
          <option value="price:desc">Sort by: Price: High to Low</option>
        </select>
      </div>

      @if (isLoading()) {
        <div class="flex justify-center items-center h-96">
          <div class="w-12 h-12 border-4 border-cyan-500 border-t-transparent rounded-full animate-spin"></div>
        </div>
      }

      <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6">
        @for (book of books(); track book._id) {
          <app-book-card
            [book]="book"
            (quickViewClicked)="onQuickView($event)">
          </app-book-card>
        } @empty {
          @if (!isLoading()) {
            <div class="col-span-full text-center h-96 flex flex-col justify-center items-center rounded-lg bg-gray-50">
              <mat-icon class="!text-7xl text-gray-300">search_off</mat-icon>
              <h3 class="text-2xl font-bold text-gray-700 mt-4">No Books Found</h3>
              <p class="text-gray-500 mt-2">Try adjusting your filters or search term.</p>
            </div>
          }
        }
      </div>

      @if (totalBooks() > pageSize()) {
        <div class="mt-8 flex justify-between items-center border-t border-gray-200 pt-6">
          <button (click)="goToPage(currentPage() - 1)"
                  [disabled]="currentPage() === 0"
                  class="flex items-center gap-2 px-4 py-2 bg-white border
                  border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700
                  hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed">
            <mat-icon>keyboard_arrow_left</mat-icon>
          </button>

          <span class="text-sm text-gray-600">
            Page <span class="font-bold">{{ currentPage() + 1 }}</span> of <span class="font-bold">{{ totalPages() }}</span>
            Previous
          </span>

          <button (click)="goToPage(currentPage() + 1)"
                  [disabled]="isLastPage()"
                  class="flex items-center gap-2 px-4 py-2 bg-white border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed">
            Next
            <mat-icon>keyboard_arrow_right</mat-icon>
          </button>
        </div>
      }
    </main>

  </div>
</div>
