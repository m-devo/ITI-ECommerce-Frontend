<app-adminlayout>
<div class="container mx-auto px-4 py-10 mb-20">

  <div class="mb-4 p-4 bg-gray-50 rounded-lg shadow-sm">
    <div class="w-full sm:w-64">
      <label for="statusFilter" class="block text-sm font-medium text-gray-700 mb-1">Filter by Status</label>
      <select id="statusFilter" [formControl]="statusFilter"
              class="block w-full rounded-md border-gray-300 shadow-sm focus:border-cyan-500 focus:ring-cyan-500 sm:text-sm">
        <option value="all">All Statuses</option>
        <option value="new">New</option>
        <option value="inProgress">In Progress</option>
        <option value="resolved">Resolved</option>
        <option value="closed">Closed</option>
      </select>
    </div>
  </div>


  <div class="relative bg-white shadow-md rounded-lg overflow-hidden">

    @if (isLoading) {
      <div class="absolute inset-0 bg-white bg-opacity-75 flex items-center justify-center z-10">
        <mat-progress-spinner mode="indeterminate" [diameter]="50"></mat-progress-spinner>
      </div>
    }
    <!-- Tables -->
    <table mat-table [dataSource]="dataSource" class="w-full">

      <!-- Ticket ID Column -->
      <ng-container matColumnDef="ticketId">
        <th mat-header-cell *matHeaderCellDef> Ticket ID </th>
        <td mat-cell *matCellDef="let row" class="font-mono text-sm">#{{ row._id.slice(-6) }}</td>
      </ng-container>

      <!-- User Column -->
      <ng-container matColumnDef="user">
        <th mat-header-cell *matHeaderCellDef> User </th>
        <td mat-cell *matCellDef="let row" class="text-sm">
          <p class="font-medium">{{ row.user.firstName }} {{ row.user.lastName }}</p>
          <p class="text-xs text-gray-500">{{ row.user.email }}</p>
        </td>
      </ng-container>

      <!-- Status Column -->
      <ng-container matColumnDef="status">
        <th mat-header-cell *matHeaderCellDef> Status </th>
        <td mat-cell *matCellDef="let row">
          <span class="px-3 py-1 rounded-full text-xs font-medium"
                [class]="row.status | statusBg">
            {{ row.status | titlecase }}
          </span>
        </td>
      </ng-container>

      <!-- Details Column -->
      <ng-container matColumnDef="details">
        <th mat-header-cell *matHeaderCellDef> Details </th>
        <td mat-cell *matCellDef="let row" class="text-sm text-gray-700 max-w-xs truncate" [title]="row.details">
          {{ row.details }}
        </td>
      </ng-container>

      <!-- Last Updated Column -->
      <ng-container matColumnDef="lastUpdated">
        <th mat-header-cell *matHeaderCellDef> Last Updated </th>
        <td mat-cell *matCellDef="let row" class="text-sm text-gray-500">
          {{ row.updatedAt | date:'medium' }}
        </td>
      </ng-container>

      <!-- Actions Column -->
      <ng-container matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef> Actions </th>
        <td mat-cell *matCellDef="let row">
          <button mat-icon-button color="primary" (click)="navigateToDetails(row._id)"
                  aria-label="Manage complaint">
            <mat-icon>manage_search</mat-icon>
          </button>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
      <!-- If the table is empty -->

      @if (!isLoading && dataSource.data.length === 0) {
        <tr class="mat-row">
          <td class="mat-cell p-4 text-center text-gray-500" [colSpan]="displayedColumns.length">
            No complaints found matching this filter.
          </td>
        </tr>
      }
    </table>

    <mat-paginator [length]="totalComplaints" [pageSizeOptions]="[5, 10, 20]"
                   [pageSize]="10" showFirstLastButtons>
    </mat-paginator>

  </div>
</div>
</app-adminlayout>
