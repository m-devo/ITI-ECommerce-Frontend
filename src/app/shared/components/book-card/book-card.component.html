<div class="group relative bg-white rounded-2xl overflow-hidden border border-gray-100 hover:shadow-2xl hover:shadow-gray-200/50 transition-all duration-300 h-full flex flex-col">

  <div class="relative aspect-[2/3] overflow-hidden bg-gray-50 p-4 flex items-center justify-center">

    <a [routerLink]="['/book', book._id]" class="w-full h-full flex justify-center">
      <img [src]="encodeImageUrl(book.imagePath)" [alt]="book.title"
        class="h-full w-auto object-contain drop-shadow-md transform transition-transform duration-700 group-hover:scale-110 group-hover:rotate-1">
    </a>

    <div class="absolute bottom-4 left-0 right-0 flex justify-center gap-3 opacity-0 translate-y-4 group-hover:opacity-100 group-hover:translate-y-0 transition-all duration-300 z-20">
      <button (click)="onClickViewClick($event)"
        class="w-10 h-10 rounded-full bg-white text-gray-700 shadow-lg hover:bg-[#00BFC5] hover:text-white flex items-center justify-center transition-colors"
        matTooltip="Quick View">
        <mat-icon class="!w-5 !h-5 text-[20px]">visibility</mat-icon>
      </button>
      <button (click)="onAddToCartClick($event)" [disabled]="!book || book.stock === 0"
        class="w-10 h-10 rounded-full bg-white text-gray-700 shadow-lg hover:bg-gray-900 hover:text-white flex items-center justify-center transition-colors disabled:opacity-50"
        matTooltip="Add to Cart">
        <mat-icon class="!w-5 !h-5 text-[20px]">shopping_cart</mat-icon>
      </button>
    </div>
  </div>

  <div class="p-5 flex flex-col flex-grow text-center">

    <p class="text-xs font-bold text-[#00BFC5] uppercase tracking-wider mb-1">
      {{ book.category }}
    </p>

    <a [routerLink]="['/book', book._id]" class="group-hover:text-[#00BFC5] transition-colors">
      <h3 class="font-serif font-bold text-lg text-gray-900 leading-snug line-clamp-1 mb-1" [title]="book.title">
        {{ book.title }}
      </h3>
    </a>

    <p class="text-sm text-gray-500 mb-2">
      By {{ book.author }}
    </p>

    <div class="flex justify-center items-center gap-1 mb-2">
      <ng-container *ngFor="let star of [1,2,3,4,5]">
        <mat-icon class="!w-4 !h-4 text-[16px]"
          [ngClass]="book.averageRating >= star ? 'text-yellow-400' : 'text-gray-200'">
          star
        </mat-icon>
      </ng-container>
      <span class="text-xs text-gray-400 ml-1">({{book.averageRating}})</span>
    </div>

    <p class="text-xs text-gray-500 line-clamp-2 mb-3 px-2">
      {{ book.description }}
    </p>

    <div class="mt-auto pt-3 border-t border-gray-100">
      <span class="font-bold text-xl text-gray-900">
        LE {{ book.price | number:'1.0-0' }}
      </span>
    </div>
  </div>

</div>
